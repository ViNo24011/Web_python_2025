{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sản phẩm</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/themify-icons@0.1.2/css/themify-icons.css">
    <link rel="stylesheet" href="{% static 'css/product.css' %}">
</head>
<body>
    <div class="main">
        <div class="navbar">
            <a href="{% url 'users:home_page' %}" class="navbar__header">
                <p class="navbar__header-logo">Warehouse</p>
                <div class="navbar__header-wrapper">
                    <p class="navbar__header-text">Quản lý kho hàng</p>
                </div>
            </a>
            <div class="navbar__content">
                <div class="navbar__content-item">
                    <a href="{% url 'users:home_page' %}" class="navbar__content-item-link">
                        <i class="fa-solid fa-chart-pie navbar__content-icon"></i>
                        <p class="navbar__content-text">Thống kê</p>
                    </a>
                </div>
                <div class="navbar__content-item">
                    <a href="#" class="navbar__content-item-link">
                        <i class="fa-solid fa-user-group navbar__content-icon"></i>
                        <p class="navbar__content-text">Quản lý người dùng</p>
                    </a>
                </div>
                <div class="navbar__content-item">
                    <a href="{% url 'partners:customer_page' %}" class="navbar__content-item-link">
                        <i class="fa-solid fa-users navbar__content-icon"></i>
                        <p class="navbar__content-text">Quản lý khách hàng</p>
                    </a>
                </div>
                <div class="navbar__content-item">
                    <a href="#" class="navbar__content-item-link navbar__content-item-parent active">
                        <i class="fa-solid fa-boxes-stacked navbar__content-icon"></i>
                        <p class="navbar__content-text">Quản lý sản phẩm</p>
                        <i class="fa-solid fa-angle-down navbar__content-sub-icon"></i>
                    </a>
                    <div class="navbar__content-sub" style="display: block;">
                        <a href="#" class="navbar__content-item-link">
                            <i class="fa-solid fa-truck-field navbar__content-icon"></i>
                            <p class="navbar__content-text">Nhà cung cấp</p>
                        </a>
                        <a href="{% url 'inventory:product_page' %}" class="navbar__content-item-link navbar__content-item-choose">
                            <i class="fa-solid fa-box navbar__content-icon"></i>
                            <p class="navbar__content-text">Sản phẩm</p>
                        </a>
                    </div>
                </div>
                <div class="navbar__content-item">
                    <a href="#" class="navbar__content-item-link navbar__content-item-parent">
                        <i class="fa-solid fa-warehouse navbar__content-icon"></i>
                        <p class="navbar__content-text">Quản lý kho</p>
                        <i class="fa-solid fa-angle-down navbar__content-sub-icon"></i>
                    </a>
                    <div class="navbar__content-sub">
                        <a href="#" class="navbar__content-item-link">
                            <i class="fa-solid fa-file-import fa-user-groug navbar__content-icon"></i>
                            <p class="navbar__content-text">Nhập hàng</p>
                        </a>
                        <a href="#" class="navbar__content-item-link">
                            <i class="fa-solid fa-file-export navbar__content-icon"></i>
                            <p class="navbar__content-text">Xuất hàng</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="content__navbar">
                <a href="" class="content__navbar-notify"><i class="fa-solid fa-bell content__navbar-notify-icon"></i></a>
                <div class="content__navbar-account">                   
                    <div class="content__navbar-account-name">
                        <div class="content_navbar-img-wrapper">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTr3jhpAFYpzxx39DRuXIYxNPXc0zI5F6IiMQ&s" class="content__navbar-account-img">
                        </div>
                        <p class="content__navbar-account-text">{{ user.get_full_name|default:user.username }}</p>
                        <i class="fa-solid fa-chevron-down content__navbar-account-icon"></i>
                    </div>
                    <div class="content__navbar-account-sub">
                       <a href="{% url 'users:logout' %}" class="content__navbar-account-item">
                          <i class="fa-solid fa-right-from-bracket content__navbar-account-icon"></i>
                          <p class="content__navbar-account-text">Đăng xuất</p>
                        </a>
                    </div>
                </div>
            </div>

            <div class="content__wrapper">
                <div class="content__header">
                    <p class="content__header-text">Sản phẩm</p>
                    <button class="content__header-add">
                        <div class="fa-solid fa-plus content__header-add-icon"></div>
                        <div class="content__header-add-text">Thêm sản phẩm</div>
                    </button>
                </div>
                <div class="content__product">
                    <table class="content__product-table">
                        <thead>
                            <tr class="content__product-header">
                                <th class="content__product-stt">STT</th>
                                <th class="content__product-operation">Thao tác</th>
                                <th class="content__product-id">Mã sản phẩm</th>
                                <th class="content__product-name">Tên sản phẩm</th>
                                <th class="content__product-category">Danh mục</th>
                                <th class="content__product-unit">Đơn vị</th>
                                <th class="content__product-price">Giá nhập</th>
                                <th class="content__product-inventory">Tồn kho</th>
                                <th class="content__product-status">Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in products %}
                            <tr class="content__product-item">
                                <td class="content__product-stt">{{ forloop.counter }}</td>
                                <td class="content__product-operation">
                                  <a href="{% url 'inventory:edit_product' product.id %}" class="content__product-fix">
                                      <i class="fa-solid fa-pen content__product-fix-icon"></i>
                                  </a>

                                 <form action="{% url 'inventory:delete_product' product.id %}" method="post" style="display: inline;">
                                     {% csrf_token %}
                                      <button type="submit" class="content__product-del" onclick="return confirm('Bạn có chắc chắn muốn xóa sản phẩm này không?');">
                                         <i class="fa-solid fa-trash content__product-del-icon"></i>
                                     </button>
                                 </form>
                                </td>
                                <td class="content__product-id">SP{{ product.id|stringformat:"03d" }}</td>
                                <td class="content__product-name">{{ product.name }}</td>
                                <td class="content__product-category">{{ product.category_name }}</td>
                                <td class="content__product-unit">{{ product.unit }}</td>
                                <td class="content__product-price">{{ product.price|floatformat:0 }} VNĐ</td>
                                <td class="content__product-inventory">{{ product.quantity }}</td>
                                <td class="content__product-status">
                                    {% if product.quantity <= product.min_quantity %}
                                        <div class="content__product-status-out" style="display: block;"><p class="content__product-out-text">Sắp hết hàng</p></div>
                                    {% else %}
                                        <div class="content__product-status-stable" style="display: block;"><p class="content__product-stable-text">Ổn định</p></div>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="9" style="text-align: center; padding: 20px;">Chưa có sản phẩm nào.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="modal js-modal">
    <div class="modal__container js-modal-container">
        <div class="modal__close js-modal-close">
            <i class="fa-solid fa-xmark modal__close-icon"></i>
        </div>
        <header class="modal__header">Thêm sản phẩm</header>
        
        <form action="{% url 'inventory:add_product' %}" method="post" class="modal__form">
            {% csrf_token %}
            
            <div class="modal_product-infor">
                <div class="modal__product-wrapper">
                    <label for="name" class="modal__product-text-wrapper"><p class="modal__product-text">Tên sản phẩm</p></label>
                    <div class="modal__product-input-wrapper"><input id="name" name="name" type="text" required placeholder="Nhập tên sản phẩm" class="modal__product-input"></div>
                </div>
                <div class="modal__product-wrapper">
                    <label for="category_name" class="modal__product-text-wrapper"><p class="modal__product-text">Danh mục</p></label>
                    <div class="modal__product-input-wrapper"><input id="category_name" name="category_name" type="text" required placeholder="Nhập danh mục" class="modal__product-input"></div>
                </div>
                <div class="modal__product-wrapper">
                    <label for="unit" class="modal__product-text-wrapper"><p class="modal__product-text">Đơn vị</p></label>
                    <div class="modal__product-input-wrapper"><input id="unit" name="unit" type="text" required placeholder="Nhập đơn vị" class="modal__product-input"></div>
                </div>
                <div class="modal__product-wrapper">
                    <label for="price" class="modal__product-text-wrapper"><p class="modal__product-text">Giá nhập</p></label>
                    <div class="modal__product-input-wrapper"><input id="price" name="price" type="number" required placeholder="Nhập giá nhập" class="modal__product-input"></div>
                </div>
                <div class="modal__product-wrapper">
                    <label for="quantity" class="modal__product-text-wrapper"><p class="modal__product-text">Số lượng ban đầu</p></label>
                    <div class="modal__product-input-wrapper"><input id="quantity" name="quantity" type="number" required placeholder="Nhập số lượng" class="modal__product-input"></div>
                </div>
                <div class="modal__product-wrapper">
                    <label for="min_quantity" class="modal__product-text-wrapper"><p class="modal__product-text">Lượng cảnh báo</p></label>
                    <div class="modal__product-input-wrapper"><input id="min_quantity" name="min_quantity" type="number" required placeholder="Nhập số lượng cảnh báo" class="modal__product-input"></div>
                </div>
            </div>
            <div class="modal__submit">
                <button type="submit" class="modal__submit-btn"><p class="modal__submit-text">Lưu</p></button>
            </div>
        </form>
    </div>
</div>

    <script>
        // Script cho menu xổ xuống
        document.querySelectorAll(".navbar__content-item .navbar__content-item-parent").forEach((title) => {
            title.addEventListener("click", function(event) {
                event.preventDefault();
                const child = this.nextElementSibling;
                const isOpen = child.style.display === "block";
                child.style.display = isOpen ? "none" : "block";
                this.classList.toggle("active", !isOpen);
            });
        });

        // Script cho modal Thêm/Sửa sản phẩm
        const addBtn = document.querySelector('.content__header-add');
        const modal = document.querySelector('.js-modal');
        const modalContainer = document.querySelector('.js-modal-container');
        const modalClose = document.querySelector('.js-modal-close');

        function showModal(){ modal.classList.add('open'); }
        function hideModal(){ modal.classList.remove('open'); }

        addBtn.addEventListener('click', showModal);
        
        // Cần thêm event listener cho các nút sửa sau khi dữ liệu được tải
        document.querySelectorAll('.content__product-fix').forEach(fixBtn => {
            fixBtn.addEventListener('click', showModal);
        });

        modalClose.addEventListener('click', hideModal);
        modal.addEventListener('click', hideModal);
        modalContainer.addEventListener('click', function(event){
            event.stopPropagation();
        });
    </script>
</body>
</html>