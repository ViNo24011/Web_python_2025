{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω phi·∫øu xu·∫•t</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/themify-icons@0.1.2/css/themify-icons.css">
    <link rel="stylesheet" href="{% static 'css/product.css' %}">
    <link rel="stylesheet" href="{% static 'css/export.css' %}">
</head>
<body>
    <div class="main">
        <div class="navbar">
            <a href="{% url 'users:home_page' %}" class="navbar__header">
                <p class="navbar__header-logo">Warehouse</p>
                <div class="navbar__header-wrapper">
                    <p class="navbar__header-text">Qu·∫£n l√Ω kho h√†ng</p>
                </div>
            </a>
            <div class="navbar__content">
                <div class="navbar__content-item">
                    <a href="{% url 'users:home_page' %}" class="navbar__content-item-link">
                        <i class="fa-solid fa-chart-pie navbar__content-icon"></i>
                        <p class="navbar__content-text">Th·ªëng k√™</p>
                    </a>
                </div>
                <div class="navbar__content-item">
                    <a href="#" class="navbar__content-item-link">
                        <i class="fa-solid fa-user-group navbar__content-icon"></i>
                        <p class="navbar__content-text">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</p>
                    </a>
                </div>
                <div class="navbar__content-item">
                    <a href="{% url 'partners:customer_page' %}" class="navbar__content-item-link">
                        <i class="fa-solid fa-users navbar__content-icon"></i>
                        <p class="navbar__content-text">Qu·∫£n l√Ω kh√°ch h√†ng</p>
                    </a>
                </div>
                <div class="navbar__content-item">
                    <a href="#" class="navbar__content-item-link navbar__content-item-parent">
                        <i class="fa-solid fa-boxes-stacked navbar__content-icon"></i>
                        <p class="navbar__content-text">Qu·∫£n l√Ω s·∫£n ph·∫©m</p>
                        <i class="fa-solid fa-angle-down navbar__content-sub-icon"></i>
                    </a>
                    <div class="navbar__content-sub">
                        <a href="#" class="navbar__content-item-link">
                            <i class="fa-solid fa-truck-field navbar__content-icon"></i>
                            <p class="navbar__content-text">Nh√† cung c·∫•p</p>
                        </a>
                        <a href="{% url 'inventory:product_page' %}" class="navbar__content-item-link">
                            <i class="fa-solid fa-box navbar__content-icon"></i>
                            <p class="navbar__content-text">S·∫£n ph·∫©m</p>
                        </a>
                    </div>
                </div>
                <div class="navbar__content-item">
                    <a href="#" class="navbar__content-item-link navbar__content-item-parent active">
                        <i class="fa-solid fa-warehouse navbar__content-icon"></i>
                        <p class="navbar__content-text">Qu·∫£n l√Ω kho</p>
                        <i class="fa-solid fa-angle-down navbar__content-sub-icon"></i>
                    </a>
                    <div class="navbar__content-sub" style="display: block;">
                        <a href="#" class="navbar__content-item-link">
                            <i class="fa-solid fa-file-import fa-user-groug navbar__content-icon"></i>
                            <p class="navbar__content-text">Nh·∫≠p h√†ng</p>
                        </a>
                        <a href="{% url 'transactions:export_receipt_page' %}" class="navbar__content-item-link navbar__content-item-choose">
                            <i class="fa-solid fa-file-export navbar__content-icon"></i>
                            <p class="navbar__content-text">Xu·∫•t h√†ng</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="content__navbar">
                <a href="" class="content__navbar-notify"><i class="fa-solid fa-bell content__navbar-notify-icon"></i></a>
                <div class="content__navbar-account">                    
                    <div class="content__navbar-account-name">
                        <div class="content_navbar-img-wrapper">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTr3jhpAFYpzxx39DRuXIYxNPXc0zI5F6IiMQ&s" class="content__navbar-account-img">
                        </div>
                        <p class="content__navbar-account-text">{{ user.get_full_name|default:user.username }}</p>
                        <i class="fa-solid fa-chevron-down content__navbar-account-icon"></i>
                    </div>
                    <div class="content__navbar-account-sub">
                       <a href="{% url 'users:logout' %}" class="content__navbar-account-item">
                         <i class="fa-solid fa-right-from-bracket content__navbar-account-icon"></i>
                         <p class="content__navbar-account-text">ƒêƒÉng xu·∫•t</p>
                       </a>
                    </div>
                </div>
            </div>

            <div class="content__wrapper">
                <div class="content__header">
                    <p class="content__header-text">üì¶ Qu·∫£n l√Ω phi·∫øu xu·∫•t h√†ng</p>
                    <a href="{% url 'transactions:create_export_receipt_page' %}" class="content__header-add">
                        <div class="fa-solid fa-plus content__header-add-icon"></div>
                        <div class="content__header-add-text">T·∫°o phi·∫øu xu·∫•t m·ªõi</div>
                    </a>
                </div>

                <div class="content__product">
                    {% if export_receipts %}
                    <table class="content__product-table">
                        <thead>
                            <tr class="content__product-header">
                                <th style="width: 8%;">M√£ phi·∫øu</th>
                                <th style="width: 15%;">Kh√°ch h√†ng</th>
                                <th style="width: 10%;">SƒêT</th>
                                <th style="width: 15%;">ƒê·ªãa ch·ªâ</th>
                                <th style="width: 10%;">Ng√†y xu·∫•t</th>
                                <th style="width: 10%;">T·ªïng ti·ªÅn</th>
                                <th style="width: 12%;">Tr·∫°ng th√°i XN</th>
                                <th style="width: 12%;">Tr·∫°ng th√°i VC</th>
                                <th style="width: 10%; text-align: center;">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for receipt in export_receipts %}
                            <tr class="content__product-item">
                                <td style="text-align: center;"><strong>#{{ receipt.export_id }}</strong></td>
                                <td style="padding: 0 1rem;">{{ receipt.customer_name }}</td>
                                <td style="text-align: center;">{{ receipt.customer_phone }}</td>
                                <td style="padding: 0 1rem;">{{ receipt.customer_address|truncatewords:5 }}</td>
                                <td style="text-align: center;">{{ receipt.export_date|date:"d/m/Y H:i" }}</td>
                                <td class="price" style="text-align: center;">{{ receipt.total_export_order|floatformat:0 }} ƒë</td>
                                <td style="text-align: center;">
                                    {% if receipt.is_confirmed %}
                                    <span class="status-badge status-confirmed">‚úì ƒê√£ x√°c nh·∫≠n</span>
                                    {% else %}
                                    <span class="status-badge status-pending">‚è≥ Ch·ªù x√°c nh·∫≠n</span>
                                    {% endif %}
                                </td>
                                <td style="text-align: center;">
                                    {% if receipt.delivery_status == 'pending' %}
                                    <span class="status-badge status-pending">‚è≥ Ch·ªù x√°c nh·∫≠n</span>
                                    {% elif receipt.delivery_status == 'shipping' %}
                                    <span class="status-badge status-shipping">üöö ƒêang v·∫≠n chuy·ªÉn</span>
                                    {% elif receipt.delivery_status == 'delivered' %}
                                    <span class="status-badge status-delivered">‚úì ƒê√£ giao</span>
                                    {% endif %}
                                </td>
                                <td class="content__product-operation">
                                    <div class="actions">
                                        {% if not receipt.is_confirmed %}
                                            <a href="{% url 'transactions:edit_export_receipt_page' receipt.export_id %}" 
                                               class="btn btn-warning">‚úèÔ∏è S·ª≠a</a>
                                            
                                            <form method="POST" 
                                                  action="{% url 'transactions:delete_export_receipt' receipt.export_id %}" 
                                                  style="display: inline;"
                                                  onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a phi·∫øu xu·∫•t n√†y?');">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-danger">üóëÔ∏è X√≥a</button>
                                            </form>
                                            
                                            <form method="POST" 
                                                  action="{% url 'transactions:confirm_export_receipt' receipt.export_id %}" 
                                                  style="display: inline;"
                                                  onsubmit="return confirm('X√°c nh·∫≠n phi·∫øu xu·∫•t n√†y? Sau khi x√°c nh·∫≠n s·∫Ω kh√¥ng th·ªÉ s·ª≠a!');">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-success">‚úì X√°c nh·∫≠n</button>
                                            </form>
                                        {% elif receipt.delivery_status == 'shipping' %}
                                            <form method="POST" 
                                                  action="{% url 'transactions:mark_as_delivered' receipt.export_id %}" 
                                                  style="display: inline;"
                                                  onsubmit="return confirm('X√°c nh·∫≠n ƒë√£ giao h√†ng?');">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-info">üì¶ ƒê√£ giao</button>
                                            </form>
                                        {% else %}
                                            <button class="btn btn-confirmed" disabled>Ho√†n th√†nh</button>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <table>
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 20px; font-size: 1.6rem;">Ch∆∞a c√≥ phi·∫øu xu·∫•t n√†o.</td>
                        </tr>
                    </table>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script>
        // Script cho menu x·ªï xu·ªëng
        document.querySelectorAll(".navbar__content-item .navbar__content-item-parent").forEach((title) => {
            title.addEventListener("click", function(event) {
                event.preventDefault();
                const child = this.nextElementSibling;
                const isOpen = child.style.display === "block";
                
                // ƒê√≥ng t·∫•t c·∫£ c√°c menu con kh√°c
                document.querySelectorAll(".navbar__content-sub").forEach(sub => {
                    if (sub !== child) {
                        sub.style.display = "none";
                        sub.previousElementSibling.classList.remove("active");
                    }
                });

                // M·ªü/ƒë√≥ng menu hi·ªán t·∫°i
                child.style.display = isOpen ? "none" : "block";
                this.classList.toggle("active", !isOpen);
            });
        });

        // Script cho menu t√†i kho·∫£n
        document.querySelector(".content__navbar-account-name").addEventListener("click", function() {
            const subMenu = this.nextElementSibling;
            const isOpen = subMenu.style.display === "block";
            subMenu.style.display = isOpen ? "none" : "block";
        });
    </script>
</body>
</html>