{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/themify-icons@0.1.2/css/themify-icons.css">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>
<body>
    <div class="main">
        <div class="navbar">
            <a href="{% url 'users:home_page' %}" class="navbar__header">
                <p class="navbar__header-logo">Warehouse</p>
                <div class="navbar__header-wrapper">
                    <p class="navbar__header-text">Quản lý kho hàng</p>
                </div>
            </a>
            <div class="navbar__content">
                <div class="navbar__content-item">
                    <a href="{% url 'users:home_page' %}" class="navbar__content-item-link navbar__content-item-choose">
                        <i class="fa-solid fa-chart-pie navbar__content-icon"></i>
                        <p class="navbar__content-text">Thống kê</p>
                    </a>
                </div>
                <div class="navbar__content-item">
                    <a href="#" class="navbar__content-item-link">
                        <i class="fa-solid fa-user-group navbar__content-icon"></i>
                        <p class="navbar__content-text">Quản lý người dùng</p>
                    </a>
                </div>
                <div class="navbar__content-item">
                    <a href="#" class="navbar__content-item-link">
                        <i class="fa-solid fa-users navbar__content-icon"></i>
                        <p class="navbar__content-text">Quản lý khách hàng</p>
                    </a>
                </div>
                <div class="navbar__content-item">
                    <a href="#" class="navbar__content-item-link navbar__content-item-parent">
                        <i class="fa-solid fa-boxes-stacked navbar__content-icon"></i>
                        <p class="navbar__content-text">Quản lý sản phẩm</p>
                        <i class="fa-solid fa-angle-down navbar__content-sub-icon"></i>
                    </a>
                    <div class="navbar__content-sub">
                        <a href="#" class="navbar__content-item-link">
                            <i class="fa-solid fa-truck-field navbar__content-icon"></i>
                            <p class="navbar__content-text">Nhà cung cấp</p>
                        </a>
                        <a href="{% url 'inventory:product_page' %}" class="navbar__content-item-link">
                            <i class="fa-solid fa-box navbar__content-icon"></i>
                            <p class="navbar__content-text">Sản phẩm</p>
                        </a>
                    </div>
                </div>
                <div class="navbar__content-item">
                    <a href="#" class="navbar__content-item-link navbar__content-item-parent">
                        <i class="fa-solid fa-warehouse navbar__content-icon"></i>
                        <p class="navbar__content-text">Quản lý kho</p>
                        <i class="fa-solid fa-angle-down navbar__content-sub-icon"></i>
                    </a>
                    <div class="navbar__content-sub">
                        <a href="#" class="navbar__content-item-link">
                            <i class="fa-solid fa-file-import fa-user-groug navbar__content-icon"></i>
                            <p class="navbar__content-text">Nhập hàng</p>
                        </a>
                        <a href="#" class="navbar__content-item-link">
                            <i class="fa-solid fa-file-export navbar__content-icon"></i>
                            <p class="navbar__content-text">Xuất hàng</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="content__navbar">
                <a href="" class="content__navbar-notify">
                    <i class="fa-solid fa-bell content__navbar-notify-icon"></i>
                </a>

                <div class="content__navbar-account">                   
                    <div class="content__navbar-account-name">
                        <div class="content_navbar-img-wrapper">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTr3jhpAFYpzxx39DRuXIYxNPXc0zI5F6IiMQ&s" class="content__navbar-account-img"></img>
                        </div>
                        <p class="content__navbar-account-text">{{ user.get_full_name|default:user.username }}</p>
                        <i class="fa-solid fa-chevron-down content__navbar-account-icon"></i>
                    </div>
                    
                    <div class="content__navbar-account-sub">
                        <a href="#" class="content__navbar-account-item">
                            <i class="fa-solid fa-right-from-bracket content__navbar-account-icon"></i>
                            <p class="navbar__content-text">Đăng xuất</p>
                        </a>
                    </div>
                </div>
            </div>

            <div class="content__wrapper">
                <div class="content__header">
                    <p class="content__header-text">Thống kê</p>
                </div>

                <div class="content__statistic-container">
                    <div class="content__statistic">
                        <div class="content__statistic-list">
                            <div class="content__statistic-item-1">
                                <p class="content__statistic-item-text">Tổng sản phẩm</p>
                                <div class="content__statistic-item-infor" style="color: #1666e7">
                                    <i class="fa-solid fa-box content__statistic-item-icon"></i>
                                    <p class="content__statistic-item-value">{{ total_products }}</p>
                                </div>
                            </div>

                            <div class="content__statistic-item-1">
                                <p class="content__statistic-item-text">Tổng khách hàng</p>
                                <div class="content__statistic-item-infor" style="color: #00ab2b">
                                    <i class="fa-solid fa-user content__statistic-item-icon"></i>
                                    <p class="content__statistic-item-value">{{ total_customers }}</p>
                                </div>
                            </div>

                            <div class="content__statistic-item-1">
                                <p class="content__statistic-item-text">Tổng đơn hàng</p>
                                <div class="content__statistic-item-infor" style="color: #761ee8">
                                    <i class="fa-solid fa-cart-shopping content__statistic-item-icon"></i>
                                    <p class="content__statistic-item-value">{{ total_orders }}</p>
                                </div>
                            </div>

                            <div class="content__statistic-item-1">
                                <p class="content__statistic-item-text">Sản phẩm sắp hết</p>
                                <div class="content__statistic-item-infor" style="color: #e9010d">
                                    <i class="fa-solid fa-triangle-exclamation content__statistic-item-icon"></i>
                                    <p class="content__statistic-item-value">{{ products_nearing_out_of_stock }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="content__warn-wrapper">
                            <div class="content__warn">
                                <div class="content__warn-header">
                                    <i class="fa-solid fa-triangle-exclamation content__warn-icon" style="color: #f74e56"></i>
                                    <p class="content__warn-text">Cảnh báo sản phẩm sắp hết hàng</p>
                                </div>
                                
                                <div class="content__warn-sub-header">
                                    <p class="content__warn-stt content__warn-bold">STT</p>
                                    <p class="content__warn-name content__warn-bold">Tên sản phẩm</p>
                                    <p class="content__warn-remain content__warn-bold">Tồn kho</p>
                                </div>

                                <div class="content__warn-product">
                                    {% for product in low_stock_products %}
                                    <div class="content__warn-product-item">
                                        <p class="content__warn-stt">{{ forloop.counter }}</p>
                                        <p class="content__warn-name">{{ product.name }}</p>
                                        <p class="content__warn-remain" style="color: #e9010d">{{ product.quantity }}</p>
                                    </div>
                                    {% empty %}
                                    <div style="padding: 10px; text-align: center;">
                                        <p>Không có sản phẩm nào sắp hết hàng.</p>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.querySelectorAll(".navbar__content-item .navbar__content-item-parent").forEach((title, index) => {
            const key = "menuOpen" + index;
            const child = title.nextElementSibling;
            
            // Kiểm tra trạng thái đã lưu để hiển thị menu con
            if (localStorage.getItem(key) === "true") {
                child.style.display = "block";
                title.classList.add("active");
            } else {
                child.style.display = "none";
            }

            // Thêm sự kiện click
            title.addEventListener("click", function(event) {
                event.preventDefault();
                const isOpen = child.style.display === "block";
                child.style.display = isOpen ? "none" : "block";
                this.classList.toggle("active", !isOpen);
                });
        });
    </script>
</body>
</html>